<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>æ¾³é–€æ°£è±¡ä¸­å¿ƒ | ç†±å¸¶æ°£æ—‹è·¯å¾‘åœ°åœ–</title>
    <link rel="icon" href="mmclogo.jpg" type="image/jpeg">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body, html { height: 100vh; overflow: hidden; font-family: "Microsoft JhengHei", "PingFang TC", sans-serif; }
        
        header { 
            position: absolute; 
            top: 0; 
            left: 0; 
            right: 0; 
            z-index: 1000; 
            background: rgba(255,255,255,0.8); 
            backdrop-filter: blur(4px);
            padding: 8px 16px;
            display: flex;
            flex-wrap: wrap; 
            justify-content: space-between;
            align-items: center;
            gap: 10px; 
            min-height: 60px; 
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #0066CC;
            font-weight: bold;
            font-size: 16px;
            flex-shrink: 0; 
        }
        
        .logo img { width: 32px; height: 32px; border-radius: 4px; }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 10px; 
            flex-shrink: 0;
        }
        
        #typhoonMap { 
            width: 100vw; 
            height: 100vh; 
            z-index: 1;
        }
        
        .tc-popup { 
            font-size: 12px; 
            min-width: 180px;
        }
    
        .legend {
            position: absolute;
            bottom: 80px; 
            left: 20px;
            z-index: 999;
            background: rgba(255,255,255,0.95); 
            padding: 10px;
            border-radius: 4px;
            font-size: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2); 
            max-width: 200px; 
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            margin: 4px 0;
        }
        
        .legend-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
            border: 1px solid #000;
        }
        
        .legend-line {
            width: 20px;
            height: 2px;
            margin-right: 8px;
        }
        
        .legend-dashed-line {
            width: 20px;
            height: 2px;
            margin-right: 8px;
            background: linear-gradient(to right, #E60012 0%, #E60012 40%, transparent 40%, transparent 100%);
            background-size: 6px 2px;
        }

        .no-tc-notice {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 998;
            background: rgba(255,255,255,0.95);
            padding: 20px 30px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            text-align: center;
            font-size: 16px;
            color: #333;
        }

 
        .leaflet-control-zoom {
            top: 90px !important; 
            left: 20px !important; 
        }

        .tc-selector {
            padding: 4px 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            background: #fff;
            font-size: 14px;
            min-width: 150px; 
        }

        #infoPanel {
            position: absolute;
            top: 80px; 
            right: 20px;
            z-index: 999;
            background: rgba(255,255,255,0.95); 
            padding: 12px 15px;
            border-radius: 6px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            font-size: 14px;
            min-width: 220px; 
            max-width: 300px; 
        }
        .info-section {
            margin-bottom: 10px;
            padding-bottom: 8px;
            border-bottom: 1px solid #eee; 
        }
        .info-section:last-child {
            margin-bottom: 0;
            padding-bottom: 0;
            border-bottom: none;
        }
        .info-title {
            font-weight:bold; 
            color:#0066CC; 
            margin-bottom:5px;
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .info-content {
            font-size: 13px;
            line-height: 1.5; 
        }
        .highlight-text {
            color: #E60012; 
            font-weight:bold;
            font-size: 14px; 
        }
        .time-text {
            color: #0066CC; 
            font-weight:bold;
            font-size: 14px;
        }

        @keyframes typhoonRotate {
            0% { transform: translate(-50%, -50%) rotate(0deg); }
            100% { transform: translate(-50%, -50%) rotate(360deg); }
        }
        .typhoon-marker-wrapper {
            position: relative;
            width: 20px;
            height: 20px;
        }
        .typhoon-dot {
            position: absolute;
            top: 50%;
            left: 50%;
            border-radius: 50%;
            border: 1px solid #000;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
            animation: typhoonRotate 5s linear infinite;
            transform: translate(-50%, -50%);
        }
        .typhoon-dot.current {
            box-shadow: 0 0 8px rgba(230, 0, 18, 0.8);
        }

        .back-btn {
            padding: 4px 10px;
            background: #0066CC;
            color: white;
            border-radius: 4px;
            text-decoration: none;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 5px;
            white-space: nowrap; 
        }
        .back-btn:hover {
            background: #0052a3;
        }
    </style>
</head>
<body>
    <header>
        <div class="logo">
            <img src="mmclogo.jpg" alt="æ¾³é–€æ°£è±¡ä¸­å¿ƒ">
            <span>æ¾³é–€æ°£è±¡ä¸­å¿ƒ | ç†±å¸¶æ°£æ—‹è·¯å¾‘åœ°åœ–</span>
        </div>
        <div class="header-actions">
            <select id="tcSelector" class="tc-selector">
                <option value="">-- è«‹é¸æ“‡ç†±å¸¶æ°£æ—‹ --</option>
                <option value="A" selected>æ´›é</option>
                <!--<option value="B">ç†±å¸¶æ°£æ—‹B</option>-->
            </select>
            <a href="index.html" class="back-btn">
                <i class="fa fa-arrow-left"></i>è¿”å›é¦–é 
            </a>
        </div>
    </header>

    <div id="typhoonMap"></div>

    <div class="legend">
        <div class="legend-item">
            <div class="legend-dot" style="background: #BDBDBD;"></div>
            <span>ä½å£“å€</span>
        </div>
        <div class="legend-item">
            <div class="legend-dot" style="background: #FFF176;"></div>
            <span>ç†±å¸¶ä½æ°£å£“</span>
        </div>
        <div class="legend-item">
            <div class="legend-dot" style="background: #64B5F6;"></div>
            <span>ç†±å¸¶é¢¨æš´</span>
        </div>
        <div class="legend-item">
            <div class="legend-dot" style="background: #4CAF50;"></div>
            <span>å¼·çƒˆç†±å¸¶é¢¨æš´</span>
        </div>
        <div class="legend-item">
            <div class="legend-dot" style="background: #FFB74D;"></div>
            <span>é¢±é¢¨</span>
        </div>
        <div class="legend-item">
            <div class="legend-dot" style="background: #FF7043;"></div>
            <span>å¼·é¢±é¢¨</span>
        </div>
        <div class="legend-item">
            <div class="legend-dot" style="background: #BA68C8;"></div>
            <span>è¶…å¼·é¢±é¢¨</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #000;"></div>
            <span>éå»è·¯å¾‘</span>
        </div>
        <div class="legend-item">
            <div class="legend-dashed-line"></div>
            <span>é å ±è·¯å¾‘</span>
        </div>
    </div>

    <div id="infoPanel">
        <div class="info-section">
            <div class="info-title">ğŸ“ è·é›¢è³‡è¨Š</div>
            <div id="distanceInfo" class="info-content">åŠ è¼‰ä¸­...</div>
        </div>
        <div class="info-section">
            <div class="info-title">ğŸ“… é å ±åŸºæº–æ™‚é–“</div>
            <div id="forecastTimeInfo" class="info-content">åŠ è¼‰ä¸­...</div>
        </div>
    </div>

    <script>
        let map, tcPathDataA, tcPathDataB, showTC;

        document.addEventListener('DOMContentLoaded', () => {
            map = L.map('typhoonMap').setView([21.5, 114.5], 7);
            
            L.tileLayer('https://webrd0{s}.is.autonavi.com/appmaptile?lang=zh_cn&size=1&scale=1&style=8&x={x}&y={y}&z={z}', {
                subdomains: ['1', '2', '3', '4'],
                attribution: 'Â© é«˜å¾·åœ°åœ–'
            }).addTo(map);

            L.marker([22.156, 113.574], {
                icon: L.divIcon({
                    html: '<div style="width:18px;height:18px;border-radius:50%;background:#0066CC;border:1px solid #000;color:white;font-size:8px;font-weight:bold;display:flex;align-items:center;justify-content:center;">MO</div>',
                    className: '',
                    iconSize: [18, 18]
                })
            }).addTo(map).bindPopup(`
                <div class="tc-popup">
                    <div style="font-weight:bold;">æ¾³é–€</div>
                    <div>22.1987Â°N, 113.5439Â°E</div>
                </div>
            `);

            const getTcLevelBySpeed = (speed) => {
                if (speed <= 40) return { level: 0, name: 'ä½å£“å€', color: '#BDBDBD' };
                if (speed <= 62) return { level: 1, name: 'ç†±å¸¶ä½æ°£å£“', color: '#FFF176' };
                if (speed <= 87) return { level: 2, name: 'ç†±å¸¶é¢¨æš´', color: '#64B5F6' };
                if (speed <= 117) return { level: 3, name: 'å¼·çƒˆç†±å¸¶é¢¨æš´', color: '#4CAF50' };
                if (speed <= 149) return { level: 4, name: 'é¢±é¢¨', color: '#FFB74D' };
                if (speed <= 184) return { level: 5, name: 'å¼·é¢±é¢¨', color: '#FF7043' };
                return { level: 6, name: 'è¶…å¼·é¢±é¢¨', color: '#BA68C8' };
            };

            const drawTcPath = (tcData, tcName) => {
                const layers = [];
                const currentIdx = tcData.findIndex(p => p.type === "current");
                if (currentIdx === -1) return layers;

                const pastPoints = tcData.slice(0, currentIdx + 1).map(p => [p.lat, p.lng]);
                const forecastPoints = tcData.slice(currentIdx).map(p => [p.lat, p.lng]);

                // éå»è·¯å¾‘
                const pastLine = L.polyline(pastPoints, {
                    color: '#000',
                    weight: 4,
                    opacity: 0.8,
                    lineCap: 'round'
                });
                layers.push(pastLine);

                // é å ±è·¯å¾‘
                const forecastLine = L.polyline(forecastPoints, {
                    color: '#E60012',
                    weight: 4,
                    opacity: 0.8,
                    dashArray: '4,8',
                    lineCap: 'round'
                });
                layers.push(forecastLine);

                // æ¨™è¨˜ç¹ªè£½
                tcData.forEach((point, index) => {
                    const tcInfo = getTcLevelBySpeed(point.speed);
                    const isCurrent = point.type === "current";
                    const size = isCurrent ? 16 : 12;

                    const markerHtml = `
                        <div class="typhoon-marker-wrapper">
                            <div class="typhoon-dot ${isCurrent ? 'current' : ''}" 
                                 style="width: ${size}px; height: ${size}px; background: ${tcInfo.color};">
                            </div>
                        </div>
                    `;

                    const marker = L.marker([point.lat, point.lng], {
                        icon: L.divIcon({
                            html: markerHtml.trim(),
                            className: '',
                            iconSize: [20, 20]
                        })
                    });

                    let timeLabel = '';
                    if (isCurrent) {
                        timeLabel = `<div style="font-weight:bold;color:#E60012;">${tcName} - ç›®å‰æ™‚é–“ï¼š${point.time}</div>`;
                    } else if (point.type === "forecast") {
                        const hoursText = point.hours ? ` (é å ±${point.hours}å°æ™‚)` : '';
                        timeLabel = `<div style="font-weight:bold;color:#E60012;">${tcName} - é å ±æ™‚é–“ï¼š${point.time}${hoursText}</div>`;
                    } else {
                        timeLabel = `<div style="font-weight:bold;">${tcName} - ${point.time}</div>`;
                    }

                    let hoursPopup = '';
                    if (point.type === "forecast" && point.hours) {
                        hoursPopup = `<div>é å ±æ™‚é•·ï¼š${point.hours} å°æ™‚</div>`;
                    }

                    const macauLat = 22.1987;
                    const macauLng = 113.5439;
                    const distance = calculateDistance(macauLat, macauLng, point.lat, point.lng);

                    marker.bindPopup(`
                        <div class="tc-popup">
                            ${timeLabel}
                            <div>å¼·åº¦ï¼š${tcInfo.name} (${point.speed} km/h)</div>
                            <div>æ°£å£“ï¼š${point.pressure} hPa</div>
                            <div>ä½ç½®ï¼š${point.lat}Â°N, ${point.lng}Â°E</div>
                            <div>è·æ¾³é–€ï¼š${distance} å…¬é‡Œ</div>
                            ${hoursPopup}
                        </div>
                    `.trim());

                    layers.push(marker);
                });

                return layers;
            };

            const drawMacauMultipleCircles = () => {
                const macauLat = 22.1987;
                const macauLng = 113.5439;
                const circles = [
                    { radiusKm: 800, color: '#FF0000', fillOpacity: 0.01 },
                    { radiusKm: 400, color: '#000000', fillOpacity: 0.01 },
                    { radiusKm: 200, color: '#000000', fillOpacity: 0.01 },
                    { radiusKm: 100, color: '#000000', fillOpacity: 0.01 }
                ];

                circles.forEach(c => {
                    L.circle([macauLat, macauLng], {
                        radius: c.radiusKm * 1000,
                        color: c.color,
                        weight: 1,
                        opacity: 0.8,
                        fillColor: c.color,
                        fillOpacity: c.fillOpacity
                    }).addTo(map).bindPopup(`
                        <div class="tc-popup">
                            <div style="font-weight:bold;">æ¾³é–€${c.radiusKm}å…¬é‡Œç¯„åœ</div>
                            <div>åŠå¾‘ï¼š${c.radiusKm}å…¬é‡Œ</div>
                        </div>
                    `);
                });
            };
 
            // è·ç¦»è®¡ç®—æ ¸å¿ƒå‡½æ•°
            window.calculateDistance = function(lat1, lon1, lat2, lon2) {
                const R = 6371; // åœ°çƒåŠå¾„(å…¬é‡Œ)
                const dLat = (lat2 - lat1) * Math.PI / 180;
                const dLon = (lon2 - lon1) * Math.PI / 180;
                const a = 
                    Math.sin(dLat/2) * Math.sin(dLat/2) +
                    Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) * 
                    Math.sin(dLon/2) * Math.sin(dLon/2); 
                const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a)); 
                const distance = R * c;
                return Math.round(distance);
            };

            drawMacauMultipleCircles();

            // ç†±å¸¶æ°£æ—‹Aæ•¸æ“š
            tcPathDataA = [
                //éå»æ•¸æ“š+ç¾æ™‚æ•¸æ“š//
                {"lat": 9.4, "lng": 131.1, "speed": 55, "pressure": 1002, "time": "01æœˆ14æ—¥08æ™‚", "type": "past"},
                {"lat": 9.4, "lng": 131.0, "speed": 55, "pressure": 1002, "time": "01æœˆ14æ—¥11æ™‚", "type": "past"},
                {"lat": 9.3, "lng": 130.8, "speed": 55, "pressure": 1002, "time": "01æœˆ14æ—¥14æ™‚", "type": "past"},
                {"lat": 9.0, "lng": 130.8, "speed": 55, "pressure": 1002, "time": "01æœˆ14æ—¥17æ™‚", "type": "past"},
                {"lat": 9.1, "lng": 130.7, "speed": 55, "pressure": 1002, "time": "01æœˆ14æ—¥20æ™‚", "type": "past"},
                {"lat": 9.3, "lng": 130.4, "speed": 55, "pressure": 1002, "time": "01æœˆ14æ—¥23æ™‚", "type": "past"},
                {"lat": 9.4, "lng": 130.2, "speed": 55, "pressure": 1002, "time": "01æœˆ15æ—¥02æ™‚", "type": "past"},
                {"lat": 9.6, "lng": 129.9, "speed": 55, "pressure": 1002, "time": "01æœˆ15æ—¥05æ™‚", "type": "past"},
                {"lat": 9.6, "lng": 129.6, "speed": 55, "pressure": 1002, "time": "01æœˆ15æ—¥08æ™‚", "type": "past"},
                {"lat": 9.7, "lng": 129.5, "speed": 55, "pressure": 1002, "time": "01æœˆ15æ—¥11æ™‚", "type": "past"},
                {"lat": 10.1, "lng": 129.1, "speed": 65, "pressure": 1000, "time": "01æœˆ15æ—¥14æ™‚", "type": "past"},
                {"lat": 10.3, "lng": 129.0, "speed": 65, "pressure": 1000, "time": "01æœˆ15æ—¥17æ™‚", "type": "past"},
                {"lat": 10.4, "lng": 128.8, "speed": 65, "pressure": 998, "time": "01æœˆ15æ—¥20æ™‚", "type": "past"},
                {"lat": 10.5, "lng": 128.7, "speed": 65, "pressure": 998, "time": "01æœˆ15æ—¥23æ™‚", "type": "past"},
                {"lat": 10.6, "lng": 128.8, "speed": 65, "pressure": 998, "time": "01æœˆ16æ—¥02æ™‚", "type": "past"},
                {"lat": 10.7, "lng": 128.8, "speed": 65, "pressure": 998, "time": "01æœˆ16æ—¥05æ™‚", "type": "past"},
                {"lat": 11.1, "lng": 128.8, "speed": 65, "pressure": 998, "time": "01æœˆ16æ—¥08æ™‚", "type": "past"},
                {"lat": 11.6, "lng": 128.6, "speed": 65, "pressure": 998, "time": "01æœˆ16æ—¥11æ™‚", "type": "past"},
                {"lat": 11.9, "lng": 128.0, "speed": 65, "pressure": 998, "time": "01æœˆ16æ—¥14æ™‚", "type": "past"},
                {"lat": 12.3, "lng": 127.8, "speed": 75, "pressure": 995, "time": "01æœˆ16æ—¥17æ™‚", "type": "past"},
                {"lat": 12.3, "lng": 127.1, "speed": 75, "pressure": 995, "time": "01æœˆ16æ—¥20æ™‚", "type": "past"},
                {"lat": 12.3, "lng": 126.7, "speed": 75, "pressure": 995, "time": "01æœˆ16æ—¥23æ™‚", "type": "past"},
                {"lat": 12.5, "lng": 126.3, "speed": 85, "pressure": 990, "time": "01æœˆ17æ—¥02æ™‚", "type": "past"},
                {"lat": 13.1, "lng": 125.8, "speed": 85, "pressure": 990, "time": "01æœˆ17æ—¥05æ™‚", "type": "past"},
                {"lat": 13.4, "lng": 125.4, "speed": 85, "pressure": 990, "time": "01æœˆ17æ—¥08æ™‚", "type": "past"},
                {"lat": 13.6, "lng": 125.2, "speed": 90, "pressure": 985, "time": "01æœˆ17æ—¥11æ™‚", "type": "past"},
                {"lat": 13.9, "lng": 125.0, "speed": 90, "pressure": 985, "time": "01æœˆ17æ—¥14æ™‚", "type": "past"},
                {"lat": 14.5, "lng": 124.8, "speed": 90, "pressure": 985, "time": "01æœˆ17æ—¥17æ™‚", "type": "past"},
                {"lat": 14.6, "lng": 124.7, "speed": 90, "pressure": 985, "time": "01æœˆ17æ—¥20æ™‚", "type": "past"},
                {"lat": 14.9, "lng": 124.5, "speed": 85, "pressure": 990, "time": "01æœˆ17æ—¥23æ™‚", "type": "past"},
                {"lat": 15.0, "lng": 124.5, "speed": 85, "pressure": 990, "time": "01æœˆ18æ—¥02æ™‚", "type": "past"},
                {"lat": 15.0, "lng": 124.7, "speed": 85, "pressure": 990, "time": "01æœˆ18æ—¥05æ™‚", "type": "past"},
                {"lat": 14.6, "lng": 125.0, "speed": 85, "pressure": 990, "time": "01æœˆ18æ—¥08æ™‚", "type": "past"},
                {"lat": 14.4, "lng": 125.2, "speed": 85, "pressure": 990, "time": "01æœˆ18æ—¥11æ™‚", "type": "past"},
                {"lat": 14.6, "lng": 125.5, "speed": 85, "pressure": 990, "time": "01æœˆ18æ—¥14æ™‚", "type": "past"},
                {"lat": 15.1, "lng": 125.6, "speed": 75, "pressure": 995, "time": "01æœˆ18æ—¥17æ™‚", "type": "past"},
                {"lat": 15.2, "lng": 125.8, "speed": 65, "pressure": 998, "time": "01æœˆ18æ—¥20æ™‚", "type": "past"},
                {"lat": 15.8, "lng": 125.9, "speed": 55, "pressure": 1000, "time": "01æœˆ18æ—¥23æ™‚", "type": "past"},
                {"lat": 16.2, "lng": 126.2, "speed": 55, "pressure": 1000, "time": "01æœˆ19æ—¥02æ™‚", "type": "past"},
                {"lat": 16.4, "lng": 126.4, "speed": 65, "pressure": 998, "time": "01æœˆ19æ—¥05æ™‚", "type": "past"},
                {"lat": 16.6, "lng": 126.6, "speed": 65, "pressure": 998, "time": "01æœˆ19æ—¥08æ™‚", "type": "past"},
                {"lat": 16.7, "lng": 126.8, "speed": 65, "pressure": 998, "time": "01æœˆ19æ—¥11æ™‚", "type": "past"},
                {"lat": 16.6, "lng": 127.1, "speed": 65, "pressure": 998, "time": "01æœˆ19æ—¥14æ™‚", "type": "past"},
                {"lat": 16.5, "lng": 127.1, "speed": 65, "pressure": 998, "time": "01æœˆ19æ—¥17æ™‚", "type": "past"},
                {"lat": 17.0, "lng": 127.2, "speed": 65, "pressure": 998, "time": "01æœˆ19æ—¥20æ™‚", "type": "past"},
                {"lat": 17.3, "lng": 127.7, "speed": 55, "pressure": 1000, "time": "01æœˆ19æ—¥23æ™‚", "type": "past"},
                {"lat": 17.2, "lng": 127.7, "speed": 55, "pressure": 1000, "time": "01æœˆ20æ—¥02æ™‚", "type": "past"},
                {"lat": 17.2, "lng": 128.3, "speed": 55, "pressure": 1000, "time": "01æœˆ20æ—¥05æ™‚", "type": "past"},
                {"lat": 17.8, "lng": 129.0, "speed": 55, "pressure": 1000, "time": "01æœˆ20æ—¥08æ™‚", "type": "past"},
                {"lat": 18.2, "lng": 129.7, "speed": 55, "pressure": 1000, "time": "01æœˆ20æ—¥11æ™‚", "type": "past"},
                {"lat": 18.1, "lng": 130.0, "speed": 55, "pressure": 1000, "time": "01æœˆ20æ—¥14æ™‚", "type": "current"},
                //é å ±å†…å®¹//
            {"lat": 17.5, "lng": 131.5, "speed": 45, "pressure": 1002, "time": "01æœˆ21æ—¥02æ™‚", "type": "forecast", "hours": 12},
            {"lat": 16.5, "lng": 132.0, "speed": 35, "pressure": 1004, "time": "01æœˆ21æ—¥14æ™‚", "type": "forecast", "hours": 24},
            ];

            // ç†±å¸¶æ°£æ—‹Bæ•¸æ“šï¼ˆæ³¨é‡Šä¿ç•™ï¼‰
            /*tcPathDataB = [
                { lat: 24.0, lng: 146.5, speed: 45, pressure: 1004, time: "08æœˆ11æ—¥17:00", type: "past" },
                // ... åŸæœ‰æ•°æ® ...
            ];*/

            // æ›´æ–°é¢„æŠ¥åŸºå‡†æ—¶é—´é¢æ¿å‡½æ•°
            window.updateForecastTimePanel = function(v) {
                const forecastTimeInfo = document.getElementById('forecastTimeInfo');
                
                if (v === 'A') {
                    const currentPoint = tcPathDataA.find(p => p.type === "current");
                    if (currentPoint) {
                        forecastTimeInfo.innerHTML = `
                            <div>æ´›é</div>
                            <div class="time-text">2026å¹´${currentPoint.time}</div>
                        `;
                    } else {
                        forecastTimeInfo.textContent = 'æœªæ‰¾åˆ°é å ±åŸºæº–æ™‚é–“';
                    }
                } else if (v === 'B') {
                    const currentPoint = tcPathDataB.find(p => p.type === "current");
                    if (currentPoint) {
                        forecastTimeInfo.innerHTML = `
                            <div>ç†±å¸¶æ°£æ—‹B</div>
                            <div class="time-text">2026å¹´${currentPoint.time}</div>
                        `;
                    } else {
                        forecastTimeInfo.textContent = 'æœªæ‰¾åˆ°é å ±åŸºæº–æ™‚é–“';
                    }
                } else {
                    forecastTimeInfo.textContent = 'è«‹é¸æ“‡ç†±å¸¶æ°£æ—‹æŸ¥çœ‹é å ±æ™‚é–“';
                }
            };

            // æ ¸å¿ƒåˆ‡æ¢é€»è¾‘
            showTC = function(v) {
                // å…ˆæ¸…ç©ºæ‰€æœ‰èˆŠå±¤
                if (window.currentLayers) {
                    window.currentLayers.forEach(l => map.removeLayer(l));
                }
                window.currentLayers = [];
                let allPoints = [];

                // æ›´æ–°é¢æ¿
                updateDistancePanel(v);
                updateForecastTimePanel(v);

                // é¸ä¸­Aï¼šç¹ªè£½Açš„æ•¸æ“š
                if (v === 'A') {
                    const lyrA = drawTcPath(tcPathDataA, 'æ´›é');
                    window.currentLayers.push(...lyrA);
                    allPoints.push(...tcPathDataA.map(p => [p.lat, p.lng]));
                }
                // é¸ä¸­Bï¼šç¹ªè£½Bçš„æ•¸æ“š
                if (v === 'B') {
                    const lyrB = drawTcPath(tcPathDataB, 'ç†±å¸¶æ°£æ—‹B');
                    window.currentLayers.push(...lyrB);
                    allPoints.push(...tcPathDataB.map(p => [p.lat, p.lng]));
                }

                // æ·»åŠ æ–°å±¤
                window.currentLayers.forEach(l => map.addLayer(l));
                
                // è°ƒæ•´è§†å›¾
                if (allPoints.length > 0) {
                    map.fitBounds(L.polyline(allPoints).getBounds(), {
                        padding: [100, 100], // å¢åŠ å†…è¾¹è·ï¼Œé¿å…å†…å®¹è¢«é¢æ¿é®æŒ¡
                        maxZoom: 9
                    });
                }
            };

            // æ›´æ–°è·ç¦»é¢æ¿å‡½æ•°
            window.updateDistancePanel = function(v) {
                const distanceInfo = document.getElementById('distanceInfo');
                const macauLat = 22.1987;
                const macauLng = 113.5439;

                if (v === 'A') {
                    const currentPoint = tcPathDataA.find(p => p.type === "current");
                    if (currentPoint) {
                        const distance = calculateDistance(macauLat, macauLng, currentPoint.lat, currentPoint.lng);

                        distanceInfo.innerHTML = `
                            <div>æ´›é ç•¶å‰ä½ç½®</div>
                            <div class="highlight-text">è·æ¾³é–€ ${distance} å…¬é‡Œ</div>
                        `;
                    } else {
                        distanceInfo.textContent = 'æœªæ‰¾åˆ°ç•¶å‰ä½ç½®æ•¸æ“š';
                    }
                } else if (v === 'B') {
                    const currentPoint = tcPathDataB.find(p => p.type === "current");
                    if (currentPoint) {
                        const distance = calculateDistance(macauLat, macauLng, currentPoint.lat, currentPoint.lng);

                        distanceInfo.innerHTML = `
                            <div>ç†±å¸¶æ°£æ—‹B ç•¶å‰ä½ç½®</div>
                            <div class="highlight-text">è·æ¾³é–€ ${distance} å…¬é‡Œ</div>
                        `;
                    } else {
                        distanceInfo.textContent = 'æœªæ‰¾åˆ°ç•¶å‰ä½ç½®æ•¸æ“š';
                    }
                } else {
                    distanceInfo.textContent = 'è«‹é¸æ“‡ç†±å¸¶æ°£æ—‹æŸ¥çœ‹è·é›¢';
                }
            };

            // åˆå§‹åŒ–æ—¶æ˜¾ç¤ºA
            showTC('A');
            
            // é¸æ“‡æ¡†äº‹ä»¶ç¶å®š
            document.getElementById('tcSelector').addEventListener('change', function() {
                showTC(this.value);
            });

            // é–‹å•Ÿæ»¾è¼ªç¸®æ”¾
            map.scrollWheelZoom.enable();
        });
    </script>
</body>
</html>